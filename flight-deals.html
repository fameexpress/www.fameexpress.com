<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WXFCWK36');</script>
    <!-- End Google Tag Manager -->

    <title>International Flight Deal Finder - SFO & SJC | Fame Express</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Find the best international flight deals from San Francisco (SFO) and San Jose (SJC). Search multiple airports at once for the best prices.">

    <!-- Geist Font -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/geist@1.0.0/dist/font.css">

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Geist', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f8f9fa;
      }

      /* Header */
      .header {
        background: #1a1a1a;
        color: white;
        padding: 20px;
        text-align: center;
      }

      .header a {
        color: #FF9900;
        text-decoration: none;
        font-weight: 600;
      }

      .header a:hover {
        text-decoration: underline;
      }

      /* Hero Section */
      .hero {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d3748 100%);
        color: white;
        padding: 60px 20px;
        text-align: center;
      }

      .hero h1 {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 15px;
        color: white;
      }

      .hero p {
        font-size: 1.2rem;
        max-width: 600px;
        margin: 0 auto;
        color: rgb(229, 231, 235);
      }

      /* Container */
      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* Search Form */
      .search-section {
        padding: 40px 20px;
        background: white;
        margin-top: -30px;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        max-width: 900px;
        margin-left: auto;
        margin-right: auto;
        position: relative;
        z-index: 10;
      }

      .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group label {
        font-weight: 600;
        margin-bottom: 8px;
        color: #374151;
        font-size: 0.95rem;
      }

      .form-group input,
      .form-group select {
        padding: 14px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        font-family: inherit;
        transition: border-color 0.2s, box-shadow 0.2s;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #146eb4;
        box-shadow: 0 0 0 3px rgba(20, 110, 180, 0.1);
      }

      .checkbox-group {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        margin: 15px 0;
      }

      .checkbox-label {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        font-weight: 500;
        padding: 10px 16px;
        background: #f3f4f6;
        border-radius: 8px;
        transition: all 0.2s;
        border: 2px solid transparent;
      }

      .checkbox-label:hover {
        background: #e5e7eb;
      }

      .checkbox-label input {
        width: 20px;
        height: 20px;
        cursor: pointer;
      }

      .checkbox-label.checked {
        background: #dbeafe;
        border-color: #146eb4;
      }

      .search-btn {
        width: 100%;
        padding: 16px 32px;
        background: linear-gradient(135deg, #146eb4 0%, #0d5a95 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 10px;
        font-family: inherit;
      }

      .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(20, 110, 180, 0.3);
      }

      .search-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      /* Date Mode Toggle */
      .date-mode-toggle {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        background: #f3f4f6;
        padding: 6px;
        border-radius: 10px;
        width: fit-content;
      }

      .date-mode-btn {
        padding: 10px 20px;
        border: none;
        background: transparent;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-family: inherit;
        transition: all 0.2s;
        color: #6b7280;
      }

      .date-mode-btn.active {
        background: white;
        color: #146eb4;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }

      .date-inputs {
        display: none;
      }

      .date-inputs.active {
        display: grid;
      }

      /* Popular Destinations */
      .destinations-section {
        padding: 50px 20px;
      }

      .destinations-section h2 {
        font-size: 1.8rem;
        margin-bottom: 30px;
        text-align: center;
        color: #1a1a1a;
        font-weight: 800;
      }

      .destinations-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }

      .destination-btn {
        padding: 16px 20px;
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        cursor: pointer;
        text-align: left;
        transition: all 0.2s;
        font-family: inherit;
      }

      .destination-btn:hover {
        border-color: #146eb4;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }

      .destination-btn .city {
        font-weight: 700;
        font-size: 1.1rem;
        color: #1a1a1a;
        display: block;
        margin-bottom: 4px;
      }

      .destination-btn .code {
        color: #6b7280;
        font-size: 0.9rem;
      }

      /* Results Section */
      .results-section {
        padding: 30px 20px 60px;
        display: none;
      }

      .results-section.active {
        display: block;
      }

      .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .results-header h2 {
        font-size: 1.5rem;
        color: #1a1a1a;
        margin: 0;
        text-align: left;
      }

      .sort-controls {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .sort-controls label {
        font-weight: 500;
        color: #6b7280;
      }

      .sort-controls select {
        padding: 8px 12px;
        border: 2px solid #e5e7eb;
        border-radius: 6px;
        font-family: inherit;
        cursor: pointer;
      }

      /* Flight Cards */
      .flights-grid {
        display: grid;
        gap: 20px;
      }

      .flight-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        border: 2px solid #e5e7eb;
        transition: all 0.2s;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 20px;
        align-items: center;
      }

      .flight-card:hover {
        border-color: #146eb4;
        box-shadow: 0 8px 25px rgba(0,0,0,0.12);
      }

      .flight-info {
        display: grid;
        gap: 15px;
      }

      .flight-route {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .airport-code {
        font-size: 1.5rem;
        font-weight: 800;
        color: #1a1a1a;
      }

      .route-arrow {
        color: #9ca3af;
        font-size: 1.2rem;
      }

      .flight-details {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        color: #6b7280;
        font-size: 0.95rem;
      }

      .flight-details span {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .flight-price {
        text-align: right;
      }

      .price-amount {
        font-size: 1.8rem;
        font-weight: 800;
        color: #059669;
      }

      .price-label {
        color: #6b7280;
        font-size: 0.85rem;
      }

      .book-btn {
        display: inline-block;
        padding: 12px 24px;
        background: #146eb4;
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        margin-top: 10px;
        transition: all 0.2s;
      }

      .book-btn:hover {
        background: #0d5a95;
        transform: translateY(-1px);
      }

      /* Loading State */
      .loading {
        text-align: center;
        padding: 60px 20px;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #e5e7eb;
        border-top-color: #146eb4;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      /* No Results */
      .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #6b7280;
      }

      .no-results h3 {
        font-size: 1.3rem;
        margin-bottom: 10px;
        color: #374151;
      }

      /* Tips Section */
      .tips-section {
        padding: 50px 20px;
        background: white;
      }

      .tips-section h2 {
        font-size: 1.8rem;
        margin-bottom: 30px;
        text-align: center;
        color: #1a1a1a;
        font-weight: 800;
      }

      .tips-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
      }

      .tip-card {
        padding: 25px;
        background: #f8f9fa;
        border-radius: 12px;
        border-left: 4px solid #146eb4;
      }

      .tip-card h3 {
        font-size: 1.1rem;
        margin-bottom: 10px;
        color: #1a1a1a;
      }

      .tip-card p {
        color: #6b7280;
        font-size: 0.95rem;
      }

      /* Footer */
      footer {
        background: #0a0a0a;
        color: #999;
        text-align: center;
        padding: 30px 20px;
        font-size: 0.9rem;
      }

      footer a {
        color: #FF9900;
        text-decoration: none;
      }

      footer a:hover {
        text-decoration: underline;
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .hero h1 {
          font-size: 1.8rem;
        }

        .hero p {
          font-size: 1rem;
        }

        .flight-card {
          grid-template-columns: 1fr;
        }

        .flight-price {
          text-align: left;
          display: flex;
          align-items: center;
          gap: 15px;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .checkbox-group {
          flex-direction: column;
        }

        .results-header {
          flex-direction: column;
          align-items: flex-start;
        }
      }

      /* Comparison Table */
      .comparison-section {
        padding: 30px 20px;
        display: none;
      }

      .comparison-section.active {
        display: block;
      }

      .comparison-table {
        width: 100%;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      }

      .comparison-table th,
      .comparison-table td {
        padding: 16px 20px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
      }

      .comparison-table th {
        background: #1a1a1a;
        color: white;
        font-weight: 600;
      }

      .comparison-table tr:hover {
        background: #f8f9fa;
      }

      .comparison-table .best-deal {
        background: #dcfce7;
      }

      .badge {
        display: inline-block;
        padding: 4px 10px;
        background: #059669;
        color: white;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-left: 10px;
      }

      /* Multi-search Info */
      .multi-search-info {
        background: #dbeafe;
        border: 1px solid #93c5fd;
        border-radius: 8px;
        padding: 15px 20px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .multi-search-info svg {
        flex-shrink: 0;
      }

      .multi-search-info p {
        color: #1e40af;
        font-size: 0.95rem;
        margin: 0;
      }

      /* Search History */
      .search-links {
        margin-top: 25px;
        padding-top: 25px;
        border-top: 2px solid #e5e7eb;
      }

      .search-links h3 {
        font-size: 1rem;
        color: #374151;
        margin-bottom: 12px;
      }

      .search-links-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .search-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 16px;
        background: #f3f4f6;
        border-radius: 8px;
        text-decoration: none;
        color: #374151;
        font-weight: 500;
        font-size: 0.9rem;
        transition: all 0.2s;
        border: 2px solid transparent;
      }

      .search-link:hover {
        background: #e5e7eb;
        border-color: #146eb4;
        color: #146eb4;
      }

      .search-link svg {
        width: 16px;
        height: 16px;
      }
    </style>
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WXFCWK36"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Header -->
    <div class="header">
      <a href="/">← Back to Fame Express</a>
    </div>

    <!-- Hero Section -->
    <div class="hero">
      <div class="container">
        <h1>International Flight Deal Finder</h1>
        <p>Search SFO & SJC simultaneously to find the best international flight deals</p>
      </div>
    </div>

    <!-- Search Section -->
    <div class="search-section">
      <div class="multi-search-info">
        <svg width="24" height="24" fill="none" stroke="#1e40af" stroke-width="2" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M12 16v-4M12 8h.01"></path>
        </svg>
        <p><strong>Multi-Airport Search:</strong> We search both San Francisco (SFO) and San Jose (SJC) to find you the best deals. Sometimes flying from a different airport can save hundreds!</p>
      </div>

      <form id="searchForm">
        <div class="form-group">
          <label>Departure Airports</label>
          <div class="checkbox-group" id="originAirports">
            <label class="checkbox-label checked">
              <input type="checkbox" value="SFO" checked> San Francisco (SFO)
            </label>
            <label class="checkbox-label checked">
              <input type="checkbox" value="SJC" checked> San Jose (SJC)
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="OAK"> Oakland (OAK)
            </label>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="destination">Destination</label>
            <input type="text" id="destination" placeholder="City or airport code (e.g., Tokyo, NRT)" required>
          </div>
        </div>

        <div class="form-group">
          <label>Date Selection</label>
          <div class="date-mode-toggle">
            <button type="button" class="date-mode-btn active" data-mode="specific">Specific Dates</button>
            <button type="button" class="date-mode-btn" data-mode="month">Entire Month</button>
            <button type="button" class="date-mode-btn" data-mode="flexible">Flexible (+/- 3 days)</button>
          </div>
        </div>

        <div class="form-row date-inputs active" id="specificDates">
          <div class="form-group">
            <label for="departDate">Departure Date</label>
            <input type="date" id="departDate" required>
          </div>
          <div class="form-group">
            <label for="returnDate">Return Date</label>
            <input type="date" id="returnDate" required>
          </div>
        </div>

        <div class="form-row date-inputs" id="monthDates">
          <div class="form-group">
            <label for="travelMonth">Travel Month</label>
            <input type="month" id="travelMonth">
          </div>
          <div class="form-group">
            <label for="tripLength">Trip Length (days)</label>
            <select id="tripLength">
              <option value="7">1 week (7 days)</option>
              <option value="10">10 days</option>
              <option value="14" selected>2 weeks (14 days)</option>
              <option value="21">3 weeks (21 days)</option>
              <option value="30">1 month (30 days)</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="passengers">Passengers</label>
            <select id="passengers">
              <option value="1">1 Adult</option>
              <option value="2">2 Adults</option>
              <option value="3">3 Adults</option>
              <option value="4">4 Adults</option>
            </select>
          </div>
          <div class="form-group">
            <label for="cabinClass">Cabin Class</label>
            <select id="cabinClass">
              <option value="economy">Economy</option>
              <option value="premium_economy">Premium Economy</option>
              <option value="business">Business</option>
              <option value="first">First Class</option>
            </select>
          </div>
        </div>

        <button type="submit" class="search-btn" id="searchBtn">
          Search All Airports for Best Deals
        </button>

        <div class="search-links" id="searchLinks" style="display: none;">
          <h3>Open searches in new tabs:</h3>
          <div class="search-links-grid" id="searchLinksGrid"></div>
        </div>
      </form>
    </div>

    <!-- Popular Destinations -->
    <div class="destinations-section">
      <div class="container">
        <h2>Popular International Destinations</h2>
        <div class="destinations-grid" id="destinationsGrid">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- Results Section -->
    <div class="results-section" id="resultsSection">
      <div class="container">
        <div class="results-header">
          <h2 id="resultsTitle">Search Results</h2>
          <div class="sort-controls">
            <label>Sort by:</label>
            <select id="sortBy">
              <option value="price">Price (Low to High)</option>
              <option value="duration">Duration (Shortest)</option>
              <option value="departure">Departure Time</option>
            </select>
          </div>
        </div>

        <!-- Comparison Table -->
        <div class="comparison-section active" id="comparisonSection">
          <table class="comparison-table">
            <thead>
              <tr>
                <th>From</th>
                <th>To</th>
                <th>Dates</th>
                <th>Est. Price</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="comparisonBody">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>

        <div class="flights-grid" id="flightsGrid">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- Tips Section -->
    <div class="tips-section">
      <div class="container">
        <h2>Tips for Finding the Best Deals</h2>
        <div class="tips-grid">
          <div class="tip-card">
            <h3>Check Multiple Airports</h3>
            <p>SFO, SJC, and OAK often have different prices for the same destination. Our tool searches all three to find the best deal.</p>
          </div>
          <div class="tip-card">
            <h3>Be Flexible with Dates</h3>
            <p>Flying mid-week (Tuesday/Wednesday) is often cheaper. Use our month view to find the cheapest days to travel.</p>
          </div>
          <div class="tip-card">
            <h3>Book in Advance</h3>
            <p>International flights are typically cheapest 2-8 months before departure. Last-minute deals are rare for international travel.</p>
          </div>
          <div class="tip-card">
            <h3>Consider Nearby Destinations</h3>
            <p>Flights to major hubs (Tokyo, London, Paris) often have more competition and lower prices than smaller cities.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <div class="container">
        <p>&copy; 2025 Fame Express LLC | San Francisco, CA</p>
        <p style="margin-top: 10px;"><a href="/">Home</a> | <a href="/privacypolicy.html">Privacy Policy</a> | <a href="/terms.html">Terms of Service</a></p>
      </div>
    </footer>

    <script>
      // Popular international destinations from Bay Area
      const popularDestinations = [
        { city: 'Tokyo', code: 'TYO', country: 'Japan' },
        { city: 'London', code: 'LON', country: 'UK' },
        { city: 'Paris', code: 'PAR', country: 'France' },
        { city: 'Seoul', code: 'SEL', country: 'South Korea' },
        { city: 'Taipei', code: 'TPE', country: 'Taiwan' },
        { city: 'Singapore', code: 'SIN', country: 'Singapore' },
        { city: 'Hong Kong', code: 'HKG', country: 'Hong Kong' },
        { city: 'Sydney', code: 'SYD', country: 'Australia' },
        { city: 'Bangkok', code: 'BKK', country: 'Thailand' },
        { city: 'Mexico City', code: 'MEX', country: 'Mexico' },
        { city: 'Cancun', code: 'CUN', country: 'Mexico' },
        { city: 'Vancouver', code: 'YVR', country: 'Canada' },
        { city: 'Amsterdam', code: 'AMS', country: 'Netherlands' },
        { city: 'Rome', code: 'ROM', country: 'Italy' },
        { city: 'Barcelona', code: 'BCN', country: 'Spain' },
        { city: 'Dublin', code: 'DUB', country: 'Ireland' },
        { city: 'Manila', code: 'MNL', country: 'Philippines' },
        { city: 'Delhi', code: 'DEL', country: 'India' },
        { city: 'Mumbai', code: 'BOM', country: 'India' },
        { city: 'Honolulu', code: 'HNL', country: 'Hawaii' },
      ];

      // Airport codes mapping for Google Flights
      const airportMapping = {
        'SFO': '/m/0d6lp',
        'SJC': '/m/0167q0',
        'OAK': '/m/0djtf',
      };

      // Destination mapping (common destinations)
      const destinationMapping = {
        'TYO': '/m/07dfk', 'NRT': '/m/0d3k14', 'HND': '/m/0156q',
        'LON': '/m/04jpl', 'LHR': '/m/04lh6', 'PAR': '/m/05qtj',
        'CDG': '/m/0156q', 'SEL': '/m/0hsqf', 'ICN': '/m/0156q',
        'TPE': '/m/0ftkx', 'SIN': '/m/06t2t', 'HKG': '/m/03h64',
        'SYD': '/m/06y57', 'BKK': '/m/0156q', 'MEX': '/m/0fwwg',
        'CUN': '/m/01n_g', 'YVR': '/m/080h2', 'AMS': '/m/0k3p',
        'ROM': '/m/06c62', 'FCO': '/m/0d3k14', 'BCN': '/m/01f62',
        'DUB': '/m/02cft', 'MNL': '/m/0156q', 'DEL': '/m/09f07',
        'BOM': '/m/04vmp', 'HNL': '/m/02hrh0',
      };

      // Cabin class mapping for Google Flights
      const cabinClassMapping = {
        'economy': '1',
        'premium_economy': '2',
        'business': '3',
        'first': '4'
      };

      let currentSearchMode = 'specific';

      // Initialize the page
      document.addEventListener('DOMContentLoaded', function() {
        initializeDateInputs();
        renderPopularDestinations();
        setupEventListeners();
      });

      function initializeDateInputs() {
        const today = new Date();
        const nextMonth = new Date(today);
        nextMonth.setMonth(nextMonth.getMonth() + 1);

        const returnDefault = new Date(nextMonth);
        returnDefault.setDate(returnDefault.getDate() + 14);

        document.getElementById('departDate').value = formatDate(nextMonth);
        document.getElementById('returnDate').value = formatDate(returnDefault);
        document.getElementById('travelMonth').value = formatMonth(nextMonth);

        // Set min dates
        document.getElementById('departDate').min = formatDate(today);
        document.getElementById('returnDate').min = formatDate(today);
      }

      function formatDate(date) {
        return date.toISOString().split('T')[0];
      }

      function formatMonth(date) {
        return date.toISOString().slice(0, 7);
      }

      function renderPopularDestinations() {
        const grid = document.getElementById('destinationsGrid');
        grid.innerHTML = popularDestinations.map(dest => `
          <button type="button" class="destination-btn" data-code="${dest.code}" data-city="${dest.city}">
            <span class="city">${dest.city}</span>
            <span class="code">${dest.code} · ${dest.country}</span>
          </button>
        `).join('');
      }

      function setupEventListeners() {
        // Checkbox styling
        document.querySelectorAll('.checkbox-label input').forEach(checkbox => {
          checkbox.addEventListener('change', function() {
            this.closest('.checkbox-label').classList.toggle('checked', this.checked);
          });
        });

        // Date mode toggle
        document.querySelectorAll('.date-mode-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            document.querySelectorAll('.date-mode-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentSearchMode = this.dataset.mode;

            document.getElementById('specificDates').classList.toggle('active', currentSearchMode === 'specific' || currentSearchMode === 'flexible');
            document.getElementById('monthDates').classList.toggle('active', currentSearchMode === 'month');

            // Update required attributes
            const specificInputs = document.querySelectorAll('#specificDates input');
            const monthInputs = document.querySelectorAll('#monthDates input, #monthDates select');

            specificInputs.forEach(input => input.required = (currentSearchMode !== 'month'));
            monthInputs.forEach(input => input.required = (currentSearchMode === 'month'));
          });
        });

        // Destination buttons
        document.querySelectorAll('.destination-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            document.getElementById('destination').value = `${this.dataset.city} (${this.dataset.code})`;
            document.getElementById('destination').focus();
          });
        });

        // Search form submission
        document.getElementById('searchForm').addEventListener('submit', handleSearch);

        // Depart date changes return date min
        document.getElementById('departDate').addEventListener('change', function() {
          const returnInput = document.getElementById('returnDate');
          if (this.value > returnInput.value) {
            const newReturn = new Date(this.value);
            newReturn.setDate(newReturn.getDate() + 7);
            returnInput.value = formatDate(newReturn);
          }
          returnInput.min = this.value;
        });
      }

      function handleSearch(e) {
        e.preventDefault();

        // Get selected airports
        const selectedAirports = Array.from(document.querySelectorAll('#originAirports input:checked'))
          .map(cb => cb.value);

        if (selectedAirports.length === 0) {
          alert('Please select at least one departure airport');
          return;
        }

        // Get destination
        const destinationInput = document.getElementById('destination').value.trim();
        let destinationCode = extractAirportCode(destinationInput);

        if (!destinationCode) {
          alert('Please enter a valid destination');
          return;
        }

        // Get dates based on mode
        let departDate, returnDate;
        const tripLength = parseInt(document.getElementById('tripLength').value);

        if (currentSearchMode === 'month') {
          const monthValue = document.getElementById('travelMonth').value;
          const monthStart = new Date(monthValue + '-01');

          // For month search, we'll create multiple date combinations
          departDate = monthValue + '-01';
          const endDate = new Date(monthStart);
          endDate.setDate(endDate.getDate() + tripLength);
          returnDate = formatDate(endDate);
        } else {
          departDate = document.getElementById('departDate').value;
          returnDate = document.getElementById('returnDate').value;
        }

        const passengers = document.getElementById('passengers').value;
        const cabinClass = document.getElementById('cabinClass').value;

        // Generate search URLs for each airport
        const searchUrls = generateSearchUrls(
          selectedAirports,
          destinationCode,
          departDate,
          returnDate,
          passengers,
          cabinClass,
          currentSearchMode === 'flexible'
        );

        // Display search links
        displaySearchLinks(searchUrls, selectedAirports, destinationInput, departDate, returnDate);

        // Show results section with comparison
        showComparisonResults(selectedAirports, destinationInput, destinationCode, departDate, returnDate);
      }

      function extractAirportCode(input) {
        // Try to extract airport code from input like "Tokyo (TYO)" or just "TYO"
        const codeMatch = input.match(/\(([A-Z]{3})\)/i) || input.match(/^([A-Z]{3})$/i);
        if (codeMatch) {
          return codeMatch[1].toUpperCase();
        }

        // Check if it's a city name we know
        const cityLower = input.toLowerCase();
        const dest = popularDestinations.find(d =>
          d.city.toLowerCase() === cityLower ||
          d.code.toLowerCase() === cityLower
        );

        if (dest) return dest.code;

        // Otherwise, treat the input as a code/destination
        return input.toUpperCase().slice(0, 3);
      }

      function generateSearchUrls(origins, destination, departDate, returnDate, passengers, cabinClass, flexible) {
        const urls = [];

        origins.forEach(origin => {
          // Google Flights URL format
          const url = buildGoogleFlightsUrl(origin, destination, departDate, returnDate, passengers, cabinClass, flexible);
          urls.push({
            airport: origin,
            url: url,
            provider: 'Google Flights'
          });
        });

        return urls;
      }

      function buildGoogleFlightsUrl(origin, destination, departDate, returnDate, passengers, cabinClass, flexible) {
        // Format dates for Google Flights (YYYY-MM-DD)
        const dept = departDate.replace(/-/g, '-');
        const ret = returnDate.replace(/-/g, '-');

        // Build the Google Flights URL
        // Format: /travel/flights/origin/destination/departure/return
        let url = `https://www.google.com/travel/flights?q=Flights%20from%20${origin}%20to%20${destination}%20on%20${dept}%20through%20${ret}`;

        // Add cabin class
        if (cabinClass !== 'economy') {
          url += `&tfc=${cabinClassMapping[cabinClass]}`;
        }

        // Add passengers
        if (passengers > 1) {
          url += `&px=${passengers}`;
        }

        return url;
      }

      function displaySearchLinks(searchUrls, airports, destination, departDate, returnDate) {
        const linksContainer = document.getElementById('searchLinks');
        const linksGrid = document.getElementById('searchLinksGrid');

        linksGrid.innerHTML = searchUrls.map(search => `
          <a href="${search.url}" target="_blank" rel="noopener" class="search-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              <polyline points="15 3 21 3 21 9"></polyline>
              <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
            ${search.airport} → ${destination.split('(')[0].trim()}
          </a>
        `).join('');

        // Add "Open All" button
        linksGrid.innerHTML += `
          <a href="#" class="search-link" style="background: #146eb4; color: white;" onclick="openAllSearches(event)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="9" y1="3" x2="9" y2="21"></line>
            </svg>
            Open All (${searchUrls.length} tabs)
          </a>
        `;

        linksContainer.style.display = 'block';

        // Store URLs for "Open All" functionality
        window.currentSearchUrls = searchUrls;
      }

      function openAllSearches(e) {
        e.preventDefault();
        if (window.currentSearchUrls) {
          window.currentSearchUrls.forEach((search, index) => {
            setTimeout(() => {
              window.open(search.url, '_blank');
            }, index * 300); // Slight delay to prevent popup blocking
          });
        }
      }

      function showComparisonResults(airports, destinationInput, destinationCode, departDate, returnDate) {
        const resultsSection = document.getElementById('resultsSection');
        const comparisonBody = document.getElementById('comparisonBody');
        const resultsTitle = document.getElementById('resultsTitle');

        resultsTitle.textContent = `Comparing Flights to ${destinationInput}`;

        // Format dates for display
        const deptDisplay = new Date(departDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        const retDisplay = new Date(returnDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

        // Generate comparison rows
        comparisonBody.innerHTML = airports.map((airport, index) => {
          const url = buildGoogleFlightsUrl(airport, destinationCode, departDate, returnDate,
            document.getElementById('passengers').value,
            document.getElementById('cabinClass').value,
            false);

          return `
            <tr class="${index === 0 ? 'best-deal' : ''}">
              <td><strong>${airport}</strong> - ${getAirportName(airport)}</td>
              <td><strong>${destinationCode}</strong></td>
              <td>${deptDisplay} - ${retDisplay}</td>
              <td>
                <span style="color: #059669; font-weight: 600;">View Prices</span>
                ${index === 0 ? '<span class="badge">Check First</span>' : ''}
              </td>
              <td>
                <a href="${url}" target="_blank" rel="noopener" class="book-btn" style="padding: 8px 16px; font-size: 0.9rem;">
                  Search →
                </a>
              </td>
            </tr>
          `;
        }).join('');

        resultsSection.style.display = 'block';
        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      function getAirportName(code) {
        const names = {
          'SFO': 'San Francisco International',
          'SJC': 'San Jose International',
          'OAK': 'Oakland International'
        };
        return names[code] || code;
      }
    </script>
  </body>
</html>
